<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>B42 String Extractor</title>

  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />

  <link href="pd.css" rel="stylesheet" />

  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>

<body>
<div id="app" class="container mt-4">

  <p class="pd-instructions">
    create a text file, drag and drop it into this tool. Each mod is on its own line:<br/>
    <span class="pd-wid">[workshopId]</span> space
    <span class="pd-mod">[modId]</span> space
    <span class="pd-map">[mapId if applicable]</span><br/>
    <span class="pd-comment"># a hashtag starts a comment line and gets ignored</span>
  </p>

  <p>
    <strong>example:</strong>
    <div class="pd-example">
      <span class="pd-comment"># Tile sheets</span><br/>
      <span class="pd-wid">3346506593</span>
      <span class="pd-mod">\Erikas_Tiles;</span><br/>

      <span class="pd-wid">3046728955</span>
      <span class="pd-mod">\tikitown_tiles;</span><br/>

      <span class="pd-comment"># Maps</span><br/>
      <span class="pd-wid">3602388131</span>
      <span class="pd-mod">\Greenleaf B42 version;</span>
      <span class="pd-map">Greenleaf;</span><br/>

      <span class="pd-comment"># our stuff (most important, goes in last)</span><br/>
      <span class="pd-wid">3639343991</span>
      <span class="pd-mod">\pdAssignments;</span>
    </div>
  </p>

  <div
    class="pd-drop mt-3"
    @dragover.prevent
    @drop.prevent="handleDrop"
  >
    <p class="fw-bold">Drag & drop a text file here</p>
    <p class="text-muted">(.txt only)</p>
  </div>

  <div v-if="WorkshopItems" class="mt-4">

    <div class="mb-3">
      <div class="d-flex justify-content-between align-items-center">
        <h6 class="mb-1">WorkshopItems</h6>
        <button class="btn btn-sm btn-outline-secondary"
                @click="copyToClipboard(WorkshopItems)">
          Copy
        </button>
      </div>
      <pre class="pd-pre">{{ WorkshopItems }}</pre>
    </div>

    <div class="mb-3">
      <div class="d-flex justify-content-between align-items-center">
        <h6 class="mb-1">Mods</h6>
        <button class="btn btn-sm btn-outline-secondary"
                @click="copyToClipboard(Mods)">
          Copy
        </button>
      </div>
      <pre class="pd-pre">{{ Mods }}</pre>
    </div>

    <div class="mb-3">
      <div class="d-flex justify-content-between align-items-center">
        <h6 class="mb-1">Maps</h6>
        <button class="btn btn-sm btn-outline-secondary"
                @click="copyToClipboard(Maps)">
          Copy
        </button>
      </div>
      <pre class="pd-pre">{{ Maps }}</pre>
    </div>

  </div>

</div>

<script>
Vue.createApp({
  data() {
    return {
      dataString: '',
      WorkshopItems: '',
      Mods: '',
      Maps: ''
    };
  },

  methods: {
    handleDrop(event) {
      const file = event.dataTransfer.files[0];
      const reader = new FileReader();
      reader.onload = e => {
        this.dataString = e.target.result;
        this.processData();
      };
      reader.readAsText(file);
    },

    copyToClipboard(text) {
      navigator.clipboard.writeText(text);
    },

    processData() {
      this.WorkshopItems = '';
      this.Mods = '';
      this.Maps = '';

      const lines = this.dataString.split(/\r?\n/);

      lines.forEach(line => {
        line = line.trim();
        if (!line || line.startsWith('#')) return;

        const match = line.match(/^(\d+)\s+(.*)$/);
        if (!match) return;

        const workshopId = match[1];
        const rest = match[2];

        this.WorkshopItems += workshopId + ';';

        const parts = rest.match(/[^;]+;/g);
        if (!parts) return;

        this.Mods += parts[0];
        if (parts[1]) this.Maps += parts[1];
      });

      if (!this.Maps.includes('Muldraugh, KY;')) {
        this.Maps += 'Muldraugh, KY;';
      }
    }
  }
}).mount('#app');
</script>

</body>
</html>
